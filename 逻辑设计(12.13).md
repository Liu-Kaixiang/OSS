##  四. 数据定义 / 逻辑设计

&emsp;&emsp;为了不与SQL Server关键字重复，"用户表"、"管理员表"、"事务表"的表名并不设为"user"、"admin"以及"transaction"，而是在三个表名之后添加'_inf'。

| 表名         | 英文名          | 功能说明               |
| ------------ | --------------- | ---------------------- |
| 用户表       | user_inf        | 保存用户信息           |
| 管理员表     | admin_inf       | 保存管理员信息         |
| 事务表       | transaction_inf | 记录事务信息           |
| 店铺表       | shop            | 记录店铺信息           |
| 商品表       | goods           | 保存商品信息           |
| 商品图片表   | goods_image     | 保存商品的预览图地址   |
| 商品属性表   | goods_attribute | 记录商品的属性信息     |
| 商品订单表   | goods_order     | 记录订单信息           |
| 订单中商品表 | goods_in_order  | 记录订单中的商品信息   |
| 收货人表     | receiver        | 记录收货信息           |
| 收藏店铺表   | favorite_shops  | 记录收藏夹中的店铺信息 |
| 收藏商品表   | favorite_goods  | 记录收藏夹中的商品信息 |
| 购物车表     | shopping_cart   | 保存购物车信息         |
| 分类表       | category        | 提供两层分类           |

###  1. 用户表

| 列名     | 数据类型（精度范围） | 空/非空 | 主键 | 外键 | 含义     | 备注                                                         |
| -------- | -------------------- | ------- | ---- | ---- | -------- | ------------------------------------------------------------ |
| user_id  | 整型                 | 非空    | 是   |      | 用户编号 | 主键，从1开始自增                                            |
| username | 可变字符型（25位）   | 非空    |      |      | 用户名   | 注册/登录时填写。唯一 。字母、数字、'-'、下划线的组合，以字母开头 |
| password | 可变字符型（120位）  | 非空    |      |      | 登录密码 | 注册/登陆时填写。字母、数字、'-'、下划线的组合，不少于 6 个字符、不超过 20 个字符。 |
| nickname | 可变字符型（20位）   |         |      |      | 昵称     | 默认为用户名                                                 |
| phone    | 字符型 (11位)        | 非空    |      |      | 手机号   | 注册/登陆时填写。唯一                                        |
| email    | 可变字符型 (20位)        | 非空    |      |      | 邮箱号   | 注册/登陆时填写。唯一                                        |
| avatar   | 可变字符型（50位）   |         |      |      | 头像     | 图片地址，默认头像为 `images/avatars/default.jpg`。当用户自主设置时，采用时间格式`yyyyMMddHHmmssSSS`(精确到毫秒)并追加随机3位(10以内)数字 + '.jpg' 形式存储于文件系统中, 并更新数据库中图片地址 |
| sex      | 枚举类型             |         |      |      | 性别     | 男，女，保密三选一                                           |
| birthday | 日期类型             |         |      |      | 出生日期 |                                                              |
| province | 可变字符型（20位） | | | | 省份 | |
| is_valid | 布尔型               | 非空    |      |      | 状态     | 默认为true                                                   |

###  2. 管理员表

| 英文名     | 数据类型（精度范围） | 空/非空 | 主键 | 外键 | 含义       | 说明                    |
| ---------- | -------------------- | ------- | ---- | ---- | ---------- | ----------------------- |
| admin_id   | 整型                 | 非空    | 是   |      | 管理员编号 | 主键，登录使用          |
| password   | 可变字符型（120位）  | 非空    |      |      | 登录密码   | 不少于6个不多于20个字符 |
| admin_name | 可变字符型（20位）   |         |      |      | 管理员名称 | 处理事务时显示          |
| email      | 可变字符型（50位）   | 非空    |      |      | 管理员邮箱 | 注册/登陆时填写。唯一   |

###  3. 事务表

| 列名               | 数据类型（精度范围） | 空/非空                 | 主键 | 外键 | 含义       | 说明                          |
| ------------------ | -------------------- | ----------------------- | ---- | ---- | ---------- | ----------------------------- |
| transaction_id     | 整型                 | 非空                    | 是   |      | 事务编号   | 主键，从1开始自增             |
| user_id            | 整型                 | 非空                    |      | 是   | 用户编号   | 外键，提交人                  |
| admin_id           | 整型                 |                         |      | 是   | 管理员编号 | 外键，处理人，提交时为空      |
| transaction_type   | 枚举类型             | 非空                    |      |      | 事务类型   | 开店申请，用户投诉            |
| transaction_status | 枚举类型             | 非空                    |      |      | 事务状态   | 未处理，已通过，已拒绝        |
| comment            | 可变字符型（300位）  | 非空 ,不超过 100 个汉字 |      |      | 内容描述   |                               |
| commit_time        | 时间类型             | 非空                    |      |      | 提交时间   |                               |
| complete_time      | 时间类型             |                         |      |      | 完毕时间   |                               |
| annotation         | 可变字符型（100位）  |                         |      |      | 处理备注   | 管理员填写 ,不超过 100 个汉字 |
| is_valid           | 布尔型               | 非空                    |      |      | 状态       | 默认为true                    |

###  4. 店铺表

| 列名            | 数据类型（精度范围） | 空/非空 | 主键 | 外键 | 含义     | 说明                                              |
| --------------- | -------------------- | ------- | ---- | ---- | -------- | ------------------------------------------------- |
| shop_id         | 整型                 | 非空    | 是   |      | 店铺编号 | 主键，自增                                        |
| user_id         | 整型                 | 非空    |      | 是   | 用户编号 | 外键，绑定的用户                                  |
| apply_status    | 字符型（10位）       | 非空    |      |      | 申请状态 | 待审核，已通过，未通过，默认待审核                |
| shop_name       | 可变字符型（90位）   | 非空    |      |      | 店铺名称 | 不超过 30 个汉字                                  |
| address         | 可变字符型（150位）  | 非空    |      |      | 店铺地址 | 不超过 50 个汉字                                  |
| phone           | 字符型（11位）       | 非空    |      |      | 联系方式 | 用户手机号                                        |
| shop_describe   | 可变字符型（300位）  |         |      |      | 店铺描述 | 未设置则显示默认值--"暂无描述"。不超过 100 个汉字 |
| announcement    | 可变字符型（300位）  |         |      |      | 公告     | 未设置则显示默认值--"暂无公告"。不超过 100 个汉字 |
| evaluate_sum    | 长整型               |         |      |      | 总评分   | 店铺总评分，初始为0                               |
| evaluate_number | 长整型               |         |      |      | 评分人数 | 评价过的人数，初始为0                             |
| is_valid        | 布尔型               | 非空    |      |      | 状态     | 默认为true                                        |

### 5. 商品表
| 列名              | 数值类型            | 空/非空 | 主键 | 外键 | 含义         | 备注                       |
| ----------------- | ------------------- | ------- | ---- | ---- | ------------ | -------------------------- |
| goods_id          | 整型                | 非空    | 是   |      | 商品编号     | 从1开始自增                |
| category_id       | 整型                | 非空    |      | 是   | 分类编号     |                            |
| shop_id           | 整型                | 非空    |      |      | 是           | 店铺编号                   |
| goods_name        | 可变字符型（90位）  | 非空    |      |      | 商品名称     | 不超过 30 汉字             |
| goods_describe    | 可变字符型（300位） | 空      |      |      | 商品描述     | 不超过 100 汉字            |
| sales             | 整型                | 非空    |      |      | 销量         | 默认为0                    |
| discount_deadline | 时间类型            | 空      |      |      | 打折截止时间 | 默认为 2000-01-01 00:00:00 |
| discount_rate     | double              | 空      |      |      | 打折比例     | 默认为1                    |
| is_valid          | 布尔型              | 非空    |      |      | 状态         | 默认为true                 |

### 6. 商品图片表
| 列名       | 数值类型       | 空/非空 | 主键 | 外键 | 含义     | 备注                                                         |
| ---------- | -------------- | ------- | ---- | ---- | -------- | ------------------------------------------------------------ |
| image_id   | 整型           | 非空    | 是   |      | 图像编号 | 从1开始自增                                                  |
| goods_id   | 整型           | 非空    |      | 是   | 商品编号 |                                                              |
| image_addr | 字符型（50位） | 非空    |      |      | 图像地址 | 采用时间格式`yyyyMMddHHmmssSSS`(精确到毫秒)并追加随机3位(10以内)数字 + '.jpg' 。每次获取图像时，根据图像地址排序，最多获取最近上传的 6 张 |
| is_valid   | 布尔型         | 非空    |      |      | 状态     | 默认为true                                                   |

### 7. 商品属性表
| 列名            | 数值类型           | 空/非空 | 主键 | 外键 | 含义     | 备注             |
| --------------- | ------------------ | ------- | ---- | ---- | -------- | ---------------- |
| goods_id        | 整型               | 非空    |      | 是   | 商品编号 |                  |
| cost            | double             | 非空    |      |      | 进价     |                  |
| price           | double             | 非空    |      |      | 售价     |                  |
| inventory       | 整型               | 非空    |      |      | 库存     | 默认为0          |
| is_valid        | 布尔型             | 非空    |      |      | 状态     | 默认为true       |

### 8. 商品订单表
| 列名            | 数值类型             | 空/非空 | 主键 | 外键 | 含义       | 备注                                                         |
| --------------- | -------------------- | ------- | ---- | ---- | ---------- | ------------------------------------------------------------ |
| order_id        | 长整型               | 非空    | 是   |      | 订单编号   | 提交订单时系统自动生成。16 位数字，从 1 开始，不够十六位使用前导 0 补足 |
| user_id         | 整型                 | 非空    |      | 是   | 用户编号   |                                                              |
| shop_id         | 整型                 | 空      |      | 是   | 店铺编号   |                                                              |
| order_status    | 枚举类型             | 非空    |      |      | 订单状态   | 待付款，待发货，待收货，待评价，已完成，已取消，默认待付款   |
| tracking_number | 字符型（12位）       | 空      |      |      | 运单号     | 用户下单时为空，商家发货时必须填写运单号。12 位纯数字。      |
| pay_method      | 可变长字符型（16位） | 空      |      |      | 支付方式   | 枚举。货到付款/在线支付                                      |
| order_time      | 时间类型             | 非空    |      |      | 下单时间   | 精确到秒                                                     |
| complete_time   | 时间类型             | 空      |      |      | 完成时间   |                                                              |
| annotation      | 可变字符型（100位）  | 空      |      |      | 备注       | 不超过 30 个字符                                             |
| total           | double               | 空      |      |      | 总金额     |                                                              |
| receiver_id     | 整型                 | 非空    |      |      | 收货人编号 | 收货信息                                                     |
| is_valid        | 布尔型               | 非空    |      |      | 状态       | 默认为true                                                   |

### 9. 订单中商品表
| 列名           | 数值类型            | 空/非空 | 主键 | 外键 | 含义       | 备注              |
| -------------- | ------------------- | ------- | ---- | ---- | ---------- | ----------------- |
| order_id       | 长整型              | 非空    | 是   |      | 订单编号   |                   |
| attribute_id   | 整型                | 非空    | 是   |      | 属性编号   |                   |
| goods_id       | 整型                | 非空    |      |      | 商品编号   |                   |
| goods_num      | 整型                | 非空    |      |      | 商品数量   |                   |
| cost           | double              | 非空    |      |      | 交易时成本 | 用户不可见        |
| actual_price   | double              | 非空    |      |      | 成交价     |                   |
| comment        | 可变字符型（300位） | 空      |      |      | 评价内容   | 不超过 100 个汉字 |
| evaluate_score | 短整型              | 空      |      |      | 评价分值   | 0~5,5个评分等级   |
| evaluate_time  | 时间类型            | 空      |      |      | 评价时间   |                   |

###  10. 收货人表

| 列名        | 数据类型（精度范围） | 空/非空 | 主键 | 外键 | 含义       | 备注                                   |
| ----------- | -------------------- | ------- | ---- | ---- | ---------- | -------------------------------------- |
| receiver_id | 整型                 | 非空    | 是   |      | 收货人编号 | 从1开始自增                            |
| user_id     | 整型                 | 非空    |      | 是   | 用户编号   |                                        |
| name        | 可变字符型（30位）   | 非空    |      |      | 收货人姓名 | 由中文、英文字母组成，不能含有其他字符 |
| address     | 可变字符型（150位）  | 非空    |      |      | 收货地址   |                                        |
| phone       | 字符型（11位）       | 非空    |      |      | 手机号     |                                        |
| used_times  | 整型                 | 非空    |      |      | 已使用次数 | 用户不可见，默认为0                    |
| is_valid    | 布尔型               | 非空    |      |      | 状态       | 默认为true                             |

###  11. 收藏店铺表

| 列名     | 数据类型（精度范围） | 空/非空 | 主键 | 外键 | 含义     | 备注        |
| -------- | -------------------- | ------- | ---- | ---- | -------- | ----------- |
| id       | 长整型               | 非空    | 是   |      | 收藏编号 | 从1开始自增 |
| shop_id  | 整型                 | 非空    |      | 是   | 店铺编号 |             |
| user_id  | 整型                 | 非空    |      | 是   | 用户编号 |             |
| is_valid | 布尔型               | 非空    |      |      | 状态     | 默认为true  |

###  12. 收藏商品表

| 列名     | 数据类型（精度范围） | 空/非空 | 主键 | 外键 | 含义     | 备注        |
| -------- | -------------------- | ------- | ---- | ---- | -------- | ----------- |
| id       | 长整型               | 非空    | 是   |      | 收藏编号 | 从1开始自增 |
| goods_id | 整型                 | 非空    |      | 是   | 商品编号 |             |
| user_id  | 整型                 | 非空    |      | 是   | 用户编号 | 、          |
| is_valid | 布尔型               | 非空    |      |      | 状态     | 默认为true  |

###  13. 购物车表

| 列名         | 数据类型（精度范围） | 空/非空 | 主键 | 外键 | 含义           | 备注                                                         |
| ------------ | -------------------- | ------- | ---- | ---- | -------------- | ------------------------------------------------------------ |
| id           | 长整型               | 非空    | 是   |      | 购物车记录编号 | 从1开始自增                                                  |
| user_id      | 整型                 | 非空    |      |      | 用户编号       |                                                              |
| goods_id     | 整型                 | 非空    |      |      | 商品编号       | 为保证查询效率，增加的goods_id冗余                           |
| goods_num    | 整型                 | 非空    |      |      | 商品数量       | $\geq 1$， 当用户删除商品时，将 is_valid 改为 false，而不将商品数量减为 0 |
| is_valid     | 布尔型               | 非空    |      |      | 状态           | 默认为true                                                   |

###  14. 分类表

| 列名        | 数据类型（精度范围） | 空/非空 | 主键 | 外键 | 含义     | 备注        |
| ----------- | -------------------- | ------- | ---- | ---- | -------- | ----------- |
| category_id | 整型                 | 非空    | 是   |      | 分类编号 | 大分类 |
| category_name   | 可变字符型（30位）   | 非空    |      |      | 分类名 | 分类名      |
| is_valid    | 布尔型               | 非空    |      |      | 状态     | 默认为true  |